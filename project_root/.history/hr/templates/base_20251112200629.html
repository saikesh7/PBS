<!-- base.html with dashboard_access checking -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}HR Portal{% endblock %}</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('hr_registration.static', filename='styles.css') }}">

  <style>
    /* Critical sidebar animations - include directly in HTML */
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
      }
      
      .sidebar-overlay.active {
        display: block;
      }
    }
    
    /* Dashboard access badge */
    .dashboard-badge {
      font-size: 11px;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      background-color: rgba(255, 255, 255, 0.15);
      color: rgba(255, 255, 255, 0.9);
      margin-left: 0.5rem;
    }
    
    /* Dashboard switcher styling */
    .dashboard-switcher-item {
      padding: 0.5rem 1rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      border-radius: 4px;
      margin: 0.25rem 0.5rem;
    }
    
    .dashboard-switcher-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: #fff;
    }
    
    .dashboard-switcher-item i {
      width: 20px;
      margin-right: 0.75rem;
      text-align: center;
    }
  </style>

  {% block extra_css %}{% endblock %}
</head>
<body>

  <!-- Topbar -->
  <div class="topbar">
    <div class="topbar-left">
      <button class="sidebar-toggle" id="sidebarToggle" type="button" aria-label="Toggle menu">
        <i class="fas fa-bars fa-lg"></i>
      </button>
      <div class="topbar-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="topbar-info">
        <div class="topbar-title">HR Dashboard</div>
        <div class="topbar-subtitle">
          {% if session.get('dashboard_access') and session.get('dashboard_access')|length > 1 %}
          <span class="dashboard-badge">
            <i class="fas fa-th-large"></i> {{ session.get('dashboard_access')|length }} Dashboards
          </span>
          {% endif %}
        </div>
      </div>
    </div>
        
    <!-- Center Heading -->
    <div class="topbar-center">
      <h6 class="topbar-heading">
        <i class="fas fa-award me-2" style="color: gold;"></i><span>POINTS BASED SYSTEM</span>
      </h6>
    </div>
  </div>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="d-flex flex-column align-items-center">
        <img src="https://www.prowesssoft.com/wp-content/uploads/2025/05/Prowess-white-logo.png" alt="PS Logo" class="sidebar-logo mb-1" style="max-height: 40px;">
        <div class="text-success" style="font-size: 12px; font-weight: 500;">PROWESS SOFT</div>
      </div>
    </div>
      
    <div class="sidebar-nav">
      <a href="{{ url_for('hr_analytics.pbs_analytics') }}" {% if request.endpoint == 'hr_analytics.pbs_analytics' %}class="sidebar-nav-item active"{% else %}class="sidebar-nav-item"{% endif %}>
        <div>
          <i class="fas fa-chart-line"></i>
          <span>PBS Analytics</span>
        </div>
      </a>

      <a href="{{ url_for('hr_registration.dashboard') }}" {% if request.endpoint == 'hr_registration.dashboard' %}class="sidebar-nav-item active"{% else %}class="sidebar-nav-item"{% endif %}>
        <div>
          <i class="fas fa-home"></i>
          <span>Register Employee</span>
        </div>
      </a>

      <a href="{{ url_for('hr_employee_mgmt.employee_list') }}" {% if request.endpoint == 'hr_employee_mgmt.employee_list' %}class="sidebar-nav-item active"{% else %}class="sidebar-nav-item"{% endif %}>
        <div>
          <i class="fas fa-users"></i>
          <span>Employee List</span>
        </div>
      </a>

      <a href="{{ url_for('hr_categories.categories_dashboard') }}" {% if request.endpoint == 'hr_categories.categories_dashboard' %}class="sidebar-nav-item active"{% else %}class="sidebar-nav-item"{% endif %}>
        <div>
          <i class="fas fa-tags"></i>
          <span>Categories</span>
        </div>
      </a>

      <a href="{{ url_for('hr_registration.manage_fields') }}" {% if request.endpoint == 'hr_registration.manage_fields' %}class="sidebar-nav-item active"{% else %}class="sidebar-nav-item"{% endif %}>
        <div>
          <i class="fas fa-cogs"></i>
          <span>Manage Dynamic Fields</span>
        </div>
      </a>

      {% if can_access_update_points_page %}
      <a href="{{ url_for('hr_points_mgmt.update_user_points_page') }}" 
        class="sidebar-nav-item {% if request.endpoint == 'hr_points_mgmt.update_user_points_page' %}active{% endif %}">
        <div style="display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-coins"></i>
          <span style="white-space: nowrap;">Update Points</span>
        </div>
      </a>
      {% endif %}
      
      <a href="{{ url_for('hr_registration.update_user') }}" {% if request.endpoint == 'hr_registration.update_user' %}class="sidebar-nav-item active"{% else %}class="sidebar-nav-item"{% endif %}>
        <div>
          <i class="fas fa-user-edit"></i>
          <span>Update User</span>
        </div>
      </a>

      <a href="{{ url_for('hr_rr_review.review_r_and_r_requests') }}"
         {% if request.endpoint == 'hr_rr_review.review_r_and_r_requests' %}
            class="sidebar-nav-item active"
         {% else %}
            class="sidebar-nav-item"
         {% endif %}>
        <div>
          <i class="fas fa-tasks"></i>
          <span>Review R&R Requests</span>
        </div>
      </a>
      
      <!-- Dashboard Switcher Based on dashboard_access -->
      {% if session.get('dashboard_access') and session.get('dashboard_access')|length > 1 %}
      <div class="sidebar-divider"></div>
      <div class="px-3 py-2">
        <small class="text-white-50 text-uppercase" style="font-size: 11px;">
          <i class="fas fa-th-large me-1"></i> Switch Dashboard
        </small>
      </div>
      
      {% for dashboard in session.get('dashboard_access', []) %}
        {% if dashboard != 'hr' %}
          {% if dashboard == 'pm' %}
          <a href="{{ url_for('pm.dashboard') }}" class="dashboard-switcher-item">
            <i class="fas fa-project-diagram"></i>
            <span>PM Dashboard</span>
          </a>
          {% elif dashboard == 'pmo' %}
          <a href="{{ url_for('pmo.dashboard') }}" class="dashboard-switcher-item">
            <i class="fas fa-tasks"></i>
            <span>PMO Dashboard</span>
          </a>
          {% elif dashboard == 'pm_arch' %}
          <a href="{{ url_for('pm_arch.dashboard') }}" class="dashboard-switcher-item">
            <i class="fas fa-drafting-compass"></i>
            <span>PM/Arch Dashboard</span>
          </a>
          {% elif dashboard == 'ta' %}
          <a href="{{ url_for('ta.dashboard') }}" class="dashboard-switcher-item">
            <i class="fas fa-users"></i>
            <span>TA Dashboard</span>
          </a>
          {% elif dashboard == 'ld' %}
          <a href="{{ url_for('ld.dashboard') }}" class="dashboard-switcher-item">
            <i class="fas fa-graduation-cap"></i>
            <span>L&D Dashboard</span>
          </a>
          {% elif dashboard == 'marketing' %}
          <a href="{{ url_for('market_manager.dashboard') }}" class="dashboard-switcher-item">
            <i class="fas fa-bullhorn"></i>
            <span>Marketing Dashboard</span>
          </a>
          {% elif dashboard == 'presales' %}
          <a href="{{ url_for('presales.dashboard') }}" class="dashboard-switcher-item">
            <i class="fas fa-handshake"></i>
            <span>Pre-sales Dashboard</span>
          </a>
          {% elif dashboard == 'central' %}
          <a href="{{ url_for('central.dashboard') }}" class="dashboard-switcher-item">
            <i class="fas fa-building"></i>
            <span>Central Dashboard</span>
          </a>
          {% endif %}
        {% endif %}
      {% endfor %}
      
      <!-- Employee Dashboard Link -->
      <a href="{{ url_for('employee_dashboard.dashboard') }}" class="dashboard-switcher-item">
        <i class="fas fa-user"></i>
        <span>Employee Dashboard</span>
      </a>
      {% endif %}
          
      <div class="sidebar-divider"></div>

      <a href="{{ url_for('auth.logout') }}" class="sidebar-nav-item">
        <div>
          <i class="fas fa-sign-out-alt"></i>
          <span>Logout</span>
        </div>
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="page-header d-flex justify-content-between align-items-center">
      <h1 class="h3">{% block page_title %}{% endblock %}</h1>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Content Block -->
    {% block content %}{% endblock %}
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Sidebar toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Get DOM elements
      const sidebarToggle = document.getElementById('sidebarToggle');
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      
      // Debug function - you can remove this in production
      function debugSidebar(action) {
        console.log(`Sidebar ${action}: `, {
          'sidebar has active class': sidebar.classList.contains('active'),
          'overlay has active class': sidebarOverlay.classList.contains('active'),
          'viewport width': window.innerWidth
        });
      }
      
      // Toggle sidebar function
      function toggleSidebar() {
        sidebar.classList.toggle('active');
        sidebarOverlay.classList.toggle('active');
        debugSidebar('toggled');
      }
      
      // Event listeners
      sidebarToggle.addEventListener('click', function(e) {
        e.preventDefault();
        toggleSidebar();
      });
      
      // Close sidebar when clicking on overlay
      sidebarOverlay.addEventListener('click', function() {
        sidebar.classList.remove('active');
        sidebarOverlay.classList.remove('active');
        debugSidebar('closed by overlay');
      });
      
      // Close sidebar when clicking a nav item (on mobile)
      document.querySelectorAll('.sidebar-nav-item, .dashboard-switcher-item').forEach(function(item) {
        item.addEventListener('click', function() {
          if (window.innerWidth < 992) {
            sidebar.classList.remove('active');
            sidebarOverlay.classList.remove('active');
            debugSidebar('closed by nav click');
          }
        });
      });
      
      // Ensure proper state on resize
      window.addEventListener('resize', function() {
        if (window.innerWidth >= 992) {
          sidebar.classList.remove('active');
          sidebarOverlay.classList.remove('active');
          debugSidebar('reset on resize');
        }
      });
      
      debugSidebar('initialized');
    });
  </script>
  
  {% block scripts %}{% endblock %}
</body>
</html>