{% extends "base.html" %}

{% block title %}Employee List - HR Dashboard{% endblock %}

{% block content %}
<div class="container-fluid pt-4 px-4">
    <div class="row g-4">
        <div class="col-12">
            <div class="bg-light rounded h-100 p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">Employee Directory</h4>
                    <div class="d-flex gap-2">
                        <a href="{{ url_for('hr_employee_mgmt.download_employee_list', department=selected_department, grade=selected_grade, us_non_us=selected_location) }}" class="btn btn-sm btn-success">
                            <i class="fa fa-download me-2"></i>Export CSV
                        </a>
                        <button type="button" class="btn btn-sm btn-danger" id="bulkActionBtn" disabled>
                            <i class="fa fa-trash me-2"></i>Bulk Actions
                        </button>
                    </div>
                </div>

                <!-- Filter Panel -->
                <div class="card mb-4">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Filters</h5>
                    </div>
                    <div class="card-body">
                        <form method="get" action="{{ url_for('hr_employee_mgmt.employee_list') }}" id="filterForm">
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label for="department" class="form-label">Department</label>
                                    <select class="form-select" id="department" name="department">
                                        <option value="">All Departments</option>
                                        {% for dept in departments %}
                                        <option value="{{ dept }}" {% if selected_department == dept %}selected="selected"{% endif %}>{{ dept }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="grade" class="form-label">Grade</label>
                                    <select class="form-select" id="grade" name="grade">
                                        <option value="">All Grades</option>
                                        {% for g in grades %}
                                        <option value="{{ g }}" {% if selected_grade == g %}selected="selected"{% endif %}>{{ g }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-3 mb-3">
                                    <label for="us_non_us" class="form-label">Location</label>
                                    <select class="form-select" id="us_non_us" name="us_non_us">
                                        <option value="">All Locations</option>
                                        {% for loc in locations %}
                                        <option value="{{ loc }}" {% if selected_location == loc %}selected="selected"{% endif %}>{{ loc }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-3 d-flex align-items-end mb-3">
                                    <button type="submit" class="btn btn-primary me-2" id="applyFiltersBtn">
                                        <span class="btn-text">Apply Filters</span>
                                        <span class="btn-loading d-none">
                                            <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
                                            Loading...
                                        </span>
                                    </button>
                                    <a href="{{ url_for('hr_employee_mgmt.employee_list') }}" class="btn btn-secondary">Reset Filters</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Employee Count Badge -->
                <div class="mb-3">
                    <span class="badge bg-info">
                        <i class="fa fa-users me-1"></i>
                        Total Employees: {{ employees|length }}
                    </span>
                </div>

                <!-- Employee List -->
                <div class="table-responsive">
                    <form id="bulkActionForm" method="post" action="{{ url_for('hr_employee_mgmt.bulk_delete_users') }}">
                        <table class="table table-bordered table-hover table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 40px;">
                                        <input type="checkbox" id="selectAll" class="form-check-input">
                                    </th>
                                    <th>Name</th>
                                    <th>Employee ID</th>
                                    <th>Email</th>
                                    <th>Grade</th>
                                    <th>Department</th>
                                    <th>Location</th>
                                    <th>Manager</th>
                                    <th>Joining Date</th>
                                    <th style="width: 150px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if employees|length > 0 %}
                                    {% for employee in employees %}
                                    <tr {% if employee.active is defined and not employee.active %}class="table-secondary" title="Inactive Employee"{% endif %}>
                                        <td>
                                            <input type="checkbox" name="user_ids" value="{{ employee._id }}" class="form-check-input user-checkbox">
                                        </td>
                                        <td>
                                            {{ employee.name }}
                                            {% if employee.active is defined and not employee.active %}
                                                <span class="badge bg-secondary ms-1">Inactive</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ employee.employee_id }}</td>
                                        <td>{{ employee.email }}</td>
                                        <td><span class="badge bg-info">{{ employee.grade }}</span></td>
                                        <td>{{ employee.department }}</td>
                                        <td>{{ employee.us_non_us or employee.location or 'Not set' }}</td>
                                        <td>{{ employee.manager_name }}</td>
                                        <td style="white-space: nowrap;">
                                            {{ employee.joining_date.strftime('%d-%m-%Y') if employee.joining_date and employee.joining_date is not string else (employee.joining_date if employee.joining_date else 'Not set') }}
                                        </td>

                                        <td>
                                            <div class="d-flex gap-2" role="group">
                                                <button type="button" class="btn btn-sm btn-info viewBtn" 
                                                        data-id="{{ employee._id }}" 
                                                        data-email="{{ employee.email }}"
                                                        title="View Details">
                                                    <i class="fa fa-eye"></i>
                                                </button>
                                                <a href="{{ url_for('hr_registration.update_user') }}?search_query={{ employee.email }}" 
                                                   class="btn btn-sm btn-warning"
                                                   title="Edit">
                                                    <i class="fa fa-edit"></i>
                                                </a>
                                                <button type="button" class="btn btn-sm btn-danger deleteBtn" 
                                                        data-id="{{ employee._id }}" 
                                                        data-name="{{ employee.name }}"
                                                        title="Delete">
                                                    <i class="fa fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="10" class="text-center py-4">
                                            <i class="fa fa-search fa-2x text-muted mb-2"></i>
                                            <p class="mb-0">No employees found matching the filter criteria.</p>
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>

                        <!-- Bulk Action Modal -->
                        <div class="modal fade" id="bulkActionModal" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Bulk Actions</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <p class="mb-3">Select an action for the selected employees:</p>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="radio" name="deletion_type" id="deactivateRadio" value="deactivate" checked>
                                            <label class="form-check-label" for="deactivateRadio">
                                                <strong>Deactivate</strong> - Soft delete (can be reactivated)
                                            </label>
                                        </div>
                                        <div class="form-check mb-3">
                                            <input class="form-check-input" type="radio" name="deletion_type" id="permanentRadio" value="permanent">
                                            <label class="form-check-label" for="permanentRadio">
                                                <strong>Permanently Delete</strong> - Remove all user data
                                            </label>
                                        </div>
                                        <div class="alert alert-warning">
                                            <i class="fa fa-exclamation-triangle me-2"></i>
                                            <strong>Warning:</strong> This action will affect <strong><span id="selectedCount">0</span></strong> user(s). 
                                            Permanent deletion cannot be undone.
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                        <button type="submit" class="btn btn-danger" id="bulkActionSubmit">
                                            <i class="fa fa-check me-2"></i>Process Selected Users
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Employee Detail Modal -->
                <div class="modal fade" id="employeeDetailModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Employee Details</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="text-center mb-4" id="loadingSpinner">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p class="mt-2">Loading employee details...</p>
                                </div>
                                <div id="employeeDetails" class="d-none">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <h5 id="empDetailName" class="mb-0"></h5>
                                            <p id="empDetailId" class="text-muted mb-0"></p>
                                        </div>
                                        <div class="col-md-6 text-md-end">
                                            <span id="empDetailStatus" class="badge bg-success">Active</span>
                                        </div>
                                    </div>

                                    <hr>

                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0"><i class="fa fa-address-card me-2"></i>Contact Information</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-2">
                                                        <i class="fa fa-envelope me-2 text-primary"></i>
                                                        <span id="empDetailEmail"></span>
                                                    </div>
                                                    <div class="mb-2">
                                                        <i class="fa fa-phone me-2 text-success"></i>
                                                        <span id="empDetailPhone"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0"><i class="fa fa-briefcase me-2"></i>Position Details</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-2">
                                                        <strong>Grade:</strong>
                                                        <span id="empDetailGrade" class="badge bg-info ms-2"></span>
                                                    </div>
                                                    <div class="mb-2">
                                                        <strong>Department:</strong>
                                                        <span id="empDetailDept"></span>
                                                    </div>
                                                    <div class="mb-2">
                                                        <strong>Location:</strong>
                                                        <span id="empDetailLocation"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0"><i class="fa fa-calendar me-2"></i>Employment Timeline</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-2">
                                                        <strong>Joining Date:</strong>
                                                        <span id="empDetailJoining"></span>
                                                    </div>
                                                    <div class="mb-2">
                                                        <strong>Exit Date:</strong>
                                                        <span id="empDetailExit">-</span>
                                                    </div>
                                                    <div class="mb-2">
                                                        <strong>Tenure:</strong>
                                                        <span id="empDetailTenure"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="card h-100">
                                                <div class="card-header bg-light">
                                                    <h6 class="mb-0"><i class="fa fa-user-tie me-2"></i>Management</h6>
                                                </div>
                                                <div class="card-body">
                                                    <div class="mb-2">
                                                        <strong>Reports To:</strong>
                                                        <span id="empDetailManager">-</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="errorMessage" class="d-none">
                                    <div class="alert alert-danger">
                                        <i class="fa fa-exclamation-circle me-2"></i>
                                        Error loading employee details. Please try again.
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <a id="editEmployeeBtn" href="#" class="btn btn-warning">
                                    <i class="fa fa-edit me-2"></i>Edit Profile
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Delete Confirmation Modal -->
                <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-danger text-white">
                                <h5 class="modal-title"><i class="fa fa-exclamation-triangle me-2"></i>Confirm Deletion</h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>Are you sure you want to delete the following employee:</p>
                                <p class="text-center"><strong id="deleteEmployeeName" class="fs-5"></strong></p>
                                
                                <hr>
                                
                                <p class="mb-2"><strong>Select deletion type:</strong></p>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="radio" name="singleDeletionType" id="singleDeactivateRadio" value="deactivate" checked>
                                    <label class="form-check-label" for="singleDeactivateRadio">
                                        <strong>Deactivate</strong> - Soft delete (can be reactivated later)
                                    </label>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="radio" name="singleDeletionType" id="singlePermanentRadio" value="permanent">
                                    <label class="form-check-label" for="singlePermanentRadio">
                                        <strong>Permanently Delete</strong> - Remove all user data and records
                                    </label>
                                </div>
                                <div class="alert alert-danger">
                                    <i class="fa fa-exclamation-triangle me-2"></i>
                                    <strong>Warning:</strong> Permanent deletion cannot be undone and will remove all associated data.
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                    <i class="fa fa-times me-2"></i>Cancel
                                </button>
                                <form id="deleteSingleForm" method="post" style="display: inline;">
                                    <input type="hidden" name="redirect_url" value="{{ url_for('hr_employee_mgmt.employee_list', department=selected_department, grade=selected_grade, us_non_us=selected_location) }}">
                                    <button type="submit" class="btn btn-danger">
                                        <i class="fa fa-trash me-2"></i>Delete
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Cross-browser compatible DOMContentLoaded
(function() {
    'use strict';
    
    // Polyfill for older browsers
    if (!Array.prototype.filter) {
        Array.prototype.filter = function(callback) {
            var filtered = [];
            for (var i = 0; i < this.length; i++) {
                if (callback(this[i], i, this)) {
                    filtered.push(this[i]);
                }
            }
            return filtered;
        };
    }
    
    if (!Array.prototype.forEach) {
        Array.prototype.forEach = function(callback) {
            for (var i = 0; i < this.length; i++) {
                callback(this[i], i, this);
            }
        };
    }
})();

document.addEventListener('DOMContentLoaded', function() {
    // ========================================
    // Filter Form Loading State (Cross-browser compatible)
    // ========================================
    const filterForm = document.getElementById('filterForm');
    const applyFiltersBtn = document.getElementById('applyFiltersBtn');
    
    if (filterForm && applyFiltersBtn) {
        filterForm.addEventListener('submit', function() {
            const btnText = applyFiltersBtn.querySelector('.btn-text');
            const btnLoading = applyFiltersBtn.querySelector('.btn-loading');
            
            if (btnText && btnLoading) {
                btnText.classList.add('d-none');
                btnLoading.classList.remove('d-none');
                applyFiltersBtn.disabled = true;
            }
        });
    }
    
    // ========================================
    // Checkbox Handling
    // ========================================
    const selectAllCheckbox = document.getElementById('selectAll');
    const userCheckboxes = document.querySelectorAll('.user-checkbox');
    const bulkActionBtn = document.getElementById('bulkActionBtn');
    
    function updateBulkActionButton() {
        const checkedCount = [...userCheckboxes].filter(cb => cb.checked).length;
        bulkActionBtn.disabled = checkedCount === 0;
        document.getElementById('selectedCount').textContent = checkedCount;
    }
    
    selectAllCheckbox.addEventListener('change', function() {
        userCheckboxes.forEach(checkbox => {
            checkbox.checked = selectAllCheckbox.checked;
        });
        updateBulkActionButton();
    });
    
    userCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            updateBulkActionButton();
            const allChecked = [...userCheckboxes].every(cb => cb.checked);
            const someChecked = [...userCheckboxes].some(cb => cb.checked);
            selectAllCheckbox.checked = allChecked;
            selectAllCheckbox.indeterminate = !allChecked && someChecked;
        });
    });
    
    // ========================================
    // Bulk Action Modal
    // ========================================
    bulkActionBtn.addEventListener('click', function() {
        const bulkActionModal = new bootstrap.Modal(document.getElementById('bulkActionModal'));
        bulkActionModal.show();
    });
    
    // Prevent double submission
    const bulkActionForm = document.getElementById('bulkActionForm');
    const bulkActionSubmit = document.getElementById('bulkActionSubmit');
    
    bulkActionForm.addEventListener('submit', function() {
        bulkActionSubmit.disabled = true;
        bulkActionSubmit.innerHTML = '<i class="fa fa-spinner fa-spin me-2"></i>Processing...';
    });
    
    // ========================================
    // View Employee Details
    // ========================================
    const viewButtons = document.querySelectorAll('.viewBtn');
    
    viewButtons.forEach(button => {
        button.addEventListener('click', function() {
            const employeeEmail = this.getAttribute('data-email');
            const detailModal = new bootstrap.Modal(document.getElementById('employeeDetailModal'));
            
            // Reset modal state
            document.getElementById('employeeDetails').classList.add('d-none');
            document.getElementById('errorMessage').classList.add('d-none');
            document.getElementById('loadingSpinner').classList.remove('d-none');
            
            // Show modal
            detailModal.show();
            
            // Fetch employee details from API
            const queryParams = new URLSearchParams();
            queryParams.append('department', '{{ selected_department or "" }}');
            queryParams.append('grade', '{{ selected_grade or "" }}');
            queryParams.append('us_non_us', '{{ selected_location or "" }}');
            
            fetch(`{{ url_for('hr_employee_mgmt.api_employees') }}?${queryParams}`)
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    if (data.employees && data.employees.length > 0) {
                        // Find the specific employee by email
                        const employee = data.employees.find(emp => emp.email === employeeEmail);
                        
                        if (employee) {
                            populateEmployeeDetails(employee);
                            
                            // Update edit button URL
                            document.getElementById('editEmployeeBtn').href = 
                                `{{ url_for('hr_registration.update_user') }}?search_query=${employee.email}`;
                            
                            // Show details, hide spinner
                            document.getElementById('loadingSpinner').classList.add('d-none');
                            document.getElementById('employeeDetails').classList.remove('d-none');
                        } else {
                            throw new Error('Employee not found');
                        }
                    } else {
                        throw new Error('No employee data received');
                    }
                })
                .catch(error => {
                    console.error('Error fetching employee details:', error);
                    document.getElementById('loadingSpinner').classList.add('d-none');
                    document.getElementById('errorMessage').classList.remove('d-none');
                });
        });
    });
    
    function populateEmployeeDetails(employee) {
        // Basic info
        document.getElementById('empDetailName').textContent = employee.name || 'N/A';
        document.getElementById('empDetailId').textContent = `Employee ID: ${employee.employee_id || 'N/A'}`;
        document.getElementById('empDetailEmail').textContent = employee.email || 'N/A';
        document.getElementById('empDetailPhone').textContent = employee.phone || 'Not provided';
        
        // Position details
        const gradeElement = document.getElementById('empDetailGrade');
        gradeElement.textContent = employee.grade || 'Not assigned';
        
        document.getElementById('empDetailDept').textContent = employee.department || 'Not assigned';
        document.getElementById('empDetailLocation').textContent = employee.us_non_us || employee.location || 'Not specified';
        
        // Timeline
        document.getElementById('empDetailJoining').textContent = employee.joining_date || 'Not recorded';
        document.getElementById('empDetailExit').textContent = employee.exit_date || 'N/A';
        
        // Calculate and display tenure
        if (employee.joining_date) {
            const tenure = calculateTenure(employee.joining_date, employee.exit_date);
            document.getElementById('empDetailTenure').textContent = tenure;
        } else {
            document.getElementById('empDetailTenure').textContent = 'Unknown';
        }
        
        // Manager info - This comes from backend as manager_name
        // But API doesn't include it, so we need to get it from the table row
        const viewBtn = [...viewButtons].find(btn => btn.getAttribute('data-email') === employee.email);
        if (viewBtn) {
            const row = viewBtn.closest('tr');
            const managerCell = row.cells[7]; // Manager column
            document.getElementById('empDetailManager').textContent = managerCell.textContent.trim() || 'Not assigned';
        } else {
            document.getElementById('empDetailManager').textContent = 'Not assigned';
        }
        
        // Status badge
        const statusBadge = document.getElementById('empDetailStatus');
        if (employee.active === false) {
            statusBadge.textContent = 'Inactive';
            statusBadge.classList.remove('bg-success');
            statusBadge.classList.add('bg-secondary');
        } else {
            statusBadge.textContent = 'Active';
            statusBadge.classList.remove('bg-secondary');
            statusBadge.classList.add('bg-success');
        }
    }
    
    function calculateTenure(joiningDate, exitDate) {
        if (!joiningDate) return 'Unknown';
        
        const start = new Date(joiningDate);
        const end = exitDate ? new Date(exitDate) : new Date();
        
        const diffTime = Math.abs(end - start);
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        
        const years = Math.floor(diffDays / 365);
        const months = Math.floor((diffDays % 365) / 30);
        const days = diffDays % 30;
        
        let tenureText = '';
        if (years > 0) tenureText += `${years} year${years > 1 ? 's' : ''} `;
        if (months > 0) tenureText += `${months} month${months > 1 ? 's' : ''} `;
        if (days > 0 || tenureText === '') tenureText += `${days} day${days !== 1 ? 's' : ''}`;
        
        return tenureText.trim();
    }
    
    // ========================================
    // Delete Employee
    // ========================================
    const deleteButtons = document.querySelectorAll('.deleteBtn');
    
    deleteButtons.forEach(button => {
        button.addEventListener('click', function() {
            const employeeId = this.getAttribute('data-id');
            const employeeName = this.getAttribute('data-name');
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
            
            document.getElementById('deleteEmployeeName').textContent = employeeName;
            
            const deleteForm = document.getElementById('deleteSingleForm');
            const deletionTypeRadios = document.querySelectorAll('input[name="singleDeletionType"]');
            
            function updateFormAction() {
                const selectedType = document.querySelector('input[name="singleDeletionType"]:checked').value;
                if (selectedType === 'deactivate') {
                    deleteForm.action = `{{ url_for('hr_employee_mgmt.deactivate_user', user_id='PLACEHOLDER') }}`.replace('PLACEHOLDER', employeeId);
                } else {
                    deleteForm.action = `{{ url_for('hr_employee_mgmt.delete_user', user_id='PLACEHOLDER') }}`.replace('PLACEHOLDER', employeeId);
                }
            }
            
            // Initial setup
            updateFormAction();
            
            // Update when radio changes
            deletionTypeRadios.forEach(radio => {
                radio.removeEventListener('change', updateFormAction); // Remove old listeners
                radio.addEventListener('change', updateFormAction);
            });
            
            deleteModal.show();
        });
    });
    
    // Prevent double submission for delete form
    const deleteSingleForm = document.getElementById('deleteSingleForm');
    deleteSingleForm.addEventListener('submit', function() {
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin me-2"></i>Deleting...';
    });
});
</script>
{% endblock %}